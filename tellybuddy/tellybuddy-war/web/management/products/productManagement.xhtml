<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/template/defaultTemplate.xhtml"
                xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="content">

        <style>
            .ui-dialog {
                border-radius: 15px;
            }

            .ui-dialog .ui-dialog-titlebar {
                background-color: #1f89ce !important;
                margin: 0px;
                padding: 15px;
            }

            .ui-dialog .ui-dialog-title {
                color: white;
            }
        </style>

        <div>

            <h3>Product Management</h3>

            <p:commandButton icon="fa fa-plus" style="margin-bottom: 20px" value="Create New Product" oncomplete="PF('dialogCreateNewProduct').show()" />

            <h:form id="searchForm">

                <p:inputText id="txtSearchString" value="#{searchProductsByNameManagedBean.searchString}" placeholder="Search Product By Name">
                    <p:ajax event="keyup" process="@this txtSearchString" update="formAllProducts:dataGridAllProducts" listener="#{searchProductsByNameManagedBean.searchProduct}" />
                </p:inputText>
                &nbsp;
                <p:commandButton value="Search">
                    <p:ajax event="click" process="@this searchForm:txtSearchString" update="formAllProducts:dataGridAllProducts" listener="#{searchProductsByNameManagedBean.searchProduct}" />
                </p:commandButton>
            </h:form>
            <br />


            <h:form id="formAllProducts">

                <p:messages id="messages" redisplay="false" closable="true" />

                <p:dataGrid id="dataGridAllProducts" var="product" value="#{searchProductsByNameManagedBean.products}" columns="3" layout="grid"
                            rows="10" paginator="true"  
                            paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                            rowsPerPageTemplate="10,20,50">
                    <f:facet name="header">
                        All Products
                    </f:facet>

                    <p:panel header="#{product.category.name}" style="text-align:center">
                        <h:panelGrid columns="1" style="width:100%">

                            <p:outputPanel>

                                <p:graphicImage width="100%" value="#{product.productImagePath}"/> 

                                <h:outputText value="#{product.name}" />
                                <br></br> <br></br>

                                <p:commandLink update="ccViewProduct:formViewProduct" oncomplete="PF('dialogViewProduct').show()" title="View Details">
                                    <h:outputText styleClass="fa fa-search" style="margin:0 auto;"/>
                                    <f:setPropertyActionListener value="#{product}" target="#{viewProductManagedBean.productToView}" />
                                </p:commandLink>&nbsp;&nbsp;

                                <p:commandLink actionListener="#{productManagementManagedBean.doUpdateProduct}" update="formUpdateProduct" oncomplete="PF('dialogUpdateProduct').show()" title="Update">
                                    <h:outputText styleClass="fa fa-edit" style="margin:0 auto;"/>
                                    <f:attribute name="productToUpdate" value="#{product}" />
                                </p:commandLink>&nbsp;

                                <p:commandLink actionListener="#{productManagementManagedBean.deleteProduct}" update="@form formAllProducts:dataGridAllProducts">
                                    <h:outputText styleClass="pi pi-trash" style="margin:0 auto;"/>
                                    <f:attribute name="productToDelete" value="#{product}" />
                                    <p:confirm header="Confirmation" message="Are you sure you want to delete #{product.name} (SKU Code: #{product.skuCode})?" icon="ui-icon-alert" />
                                </p:commandLink>
                            </p:outputPanel>
                        </h:panelGrid>
                    </p:panel>
                </p:dataGrid>

                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                </p:confirmDialog>
            </h:form>

            <ez:ViewProduct id="ccViewProduct" />




            <p:dialog id="dialogCreateNewProduct" widgetVar="dialogCreateNewProduct" header="Create New Product" closable="true" resizable="true">
                <h:form id="formCreateNewProduct"  enctype="multipart/form-data">

                    <p:messages id="messagesCreateNewProduct" redisplay="false" />

                    <p:panelGrid>
                        <p:row>
                            <p:column>
                                <p:outputLabel for="ProductType" value="Product Type" style="font-weight: bold;" /> 
                            </p:column>
                            <p:column colspan="2">
                                <p:selectOneRadio id="ProductType" value="#{productManagementManagedBean.productType}" required="true" unselectable="true" requiredMessage="Type of product must be specified" >
                                    <f:selectItem itemLabel="Non-Luxury Product" itemValue="Non-Luxury Product" />
                                    <f:selectItem itemLabel="Luxury Product" itemValue="Luxury Product" />
                                </p:selectOneRadio>
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="skuCode" value="SKU Code: " style="font-weight: bold;" />
                            </p:column>
                            <p:column>
                                <p:inputText id="skuCode" value="#{productManagementManagedBean.newProduct.skuCode}" placeholder="PROD999" required="true" requiredMessage="SKU Code is required" />
                            </p:column>
                            <p:column>
                                <p:message for="skuCode" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="name" value="Name: " style="font-weight: bold;" />
                            </p:column>
                            <p:column>
                                <p:inputText id="name" value="#{productManagementManagedBean.newProduct.name}" placeholder="Product 1" required="true" requiredMessage="Name is required" />
                            </p:column>
                            <p:column>
                                <p:message for="name" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="description" value="Description " style="font-weight: bold;" />
                            </p:column>
                            <p:column>
                                <p:inputText id="description" value="#{productManagementManagedBean.newProduct.description}" placeholder="Product 1" required="true" requiredMessage="Description is required" />
                            </p:column>
                            <p:column>
                                <p:message for="description" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="quantityOnHand" value="Quantity On Hand " style="font-weight: bold;" />
                            </p:column>
                            <p:column>
                                <p:spinner id="quantityOnHand" value="#{productManagementManagedBean.newProduct.quantityOnHand}" placeholder="100" min="0" max="1000000" required="true" requiredMessage="Quantity On Hand is required" />
                            </p:column>
                            <p:column>
                                <p:message for="quantityOnHand" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="reorderQuantity" value="Reorder Quantity " style="font-weight: bold;" />
                            </p:column>
                            <p:column>
                                <p:spinner id="reorderQuantity" value="#{productManagementManagedBean.newProduct.reorderQuantity}" placeholder="10" min="0" max="1000000" stepFactor="10" required="true" requiredMessage="Reorder Quantity is required" validator="reorderQuantityValidator" />
                            </p:column>
                            <p:column>
                                <p:message for="reorderQuantity" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="unitPrice" value="Unit Price " style="font-weight: bold;" />
                            </p:column>
                            <p:column>                            
                                <p:spinner id="unitPrice" value="#{productManagementManagedBean.newProduct.price}" placeholder="10.00" min="0" max="1000000" stepFactor="0.01" required="true" requiredMessage="Unit Price is required" />
                            </p:column>
                            <p:column>
                                <p:message for="unitPrice" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="selCategory" value="Category " style="font-weight: bold;" />
                            </p:column>
                            <p:column>
                                <p:selectOneMenu id="selCategory" value="#{productManagementManagedBean.categoryIdNew}">
                                    <f:selectItem itemValue="0" itemLabel="[Select One]" noSelectionOption="true" />
                                    <f:selectItems value="#{productManagementManagedBean.allCategories}" var="categoryEntity" itemValue="#{categoryEntity.categoryId}" itemLabel="#{categoryEntity.name}" />
                                </p:selectOneMenu>
                            </p:column>
                            <p:column>
                                <p:message for="selCategory" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="selTags" value="Tag(s) " style="font-weight: bold;" />
                            </p:column>
                            <p:column>
                                <p:selectManyMenu id="selTags" value="#{productManagementManagedBean.tagIdsNew}" showCheckbox="true">
                                    <f:selectItems value="#{productManagementManagedBean.allTags}" var="tagEntity" itemValue="#{tagEntity.tagId}" itemLabel="#{tagEntity.name}" />
                                </p:selectManyMenu>
                            </p:column>
                            <p:column>
                                <p:message for="selTags" />
                            </p:column>
                        </p:row>

                        <!--                        <p:row style="text-align:center">
                                                    <p:column colspan="3">
                                                         INCOMPLETE 
                                                        <p:commandButton value="Upload Image" icon="fa fa-image" />
                                                    </p:column>
                                                </p:row>-->

                        <p:row>
                            <p:column colspan="3">
                                <p:commandButton type="reset" value="Clear" />&nbsp;
                                <p:commandButton  value="Create New Luxury Product" rendered="#{productManagementManagedBean.productType.equals('Luxury Product')}" update="@form formAllProducts:dataGridAllProducts" actionListener="#{productManagementManagedBean.createNewProduct}" oncomplete="PF('dialogCreateNewProduct').show();" />
                                <p:commandButton  value="Create New Non-Luxury Product" rendered="#{productManagementManagedBean.productType.equals('Non-Luxury Product')}" update="@form formAllProducts:dataGridAllProducts" actionListener="#{productManagementManagedBean.createNewProduct}" oncomplete="PF('dialogCreateNewProduct').show();" />
                                <p:commandButton  value="Create New Product" update="@form formAllProducts:dataGridAllProducts" actionListener="#{productManagementManagedBean.createNewProduct}" oncomplete="PF('dialogCreateNewProduct').hide();" />
                            </p:column>
                        </p:row>



                        <p:row>
                            <p:fileUpload fileUploadListener="#{productManagementManagedBean.upload}" previewWidth="150" allowTypes=" /(\.|\/)(jpe?g|png)$/" invalidFileMessage="Please upload an image of type:.png or .jpg" required="true" requiredMessage="Product Image is required!"/>
                        </p:row>
                    </p:panelGrid> 

                </h:form>
            </p:dialog>


            <h:form id="formUpdateProduct">

                <p:dialog id="dialogUpdateProduct" widgetVar="dialogUpdateProduct" header="Update Product" closable="true" resizable="true">

                    <p:messages id="messagesUpdateProduct" redisplay="false" />

                    <p:panelGrid>

                        <p:row>
                            <p:column>
                                <h:outputLabel value="Product ID: " />
                            </p:column>
                            <p:column>
                                <h:outputText value="#{productManagementManagedBean.selectedProductToUpdate.productId}" />
                            </p:column>
                            <p:column>
                                &nbsp;
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <h:outputLabel value="SKU Code: " />
                            </p:column>
                            <p:column>
                                <h:outputText value="#{productManagementManagedBean.selectedProductToUpdate.skuCode}" />
                            </p:column>
                            <p:column>
                                &nbsp;
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="name" value="Name: " />
                            </p:column>
                            <p:column>
                                <p:inputText id="name" value="#{productManagementManagedBean.selectedProductToUpdate.name}" placeholder="Product 1" required="true" requiredMessage="Name is required" />
                            </p:column>
                            <p:column>
                                <p:message for="name" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="description" value="Description " />
                            </p:column>
                            <p:column>
                                <p:inputText id="description" value="#{productManagementManagedBean.selectedProductToUpdate.description}" placeholder="Product 1" required="true" requiredMessage="Description is required" />
                            </p:column>
                            <p:column>
                                <p:message for="description" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="quantityOnHand" value="Quantity On Hand " />
                            </p:column>
                            <p:column>
                                <p:spinner id="quantityOnHand" value="#{productManagementManagedBean.selectedProductToUpdate.quantityOnHand}" placeholder="100" min="0" max="1000000" required="true" requiredMessage="Quantity On Hand is required" />
                            </p:column>
                            <p:column>
                                <p:message for="quantityOnHand" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="reorderQuantity" value="Reorder Quantity " />
                            </p:column>
                            <p:column>
                                <p:spinner id="reorderQuantity" value="#{productManagementManagedBean.selectedProductToUpdate.reorderQuantity}" placeholder="10" min="0" max="1000000" stepFactor="10" required="true" requiredMessage="Reorder Quantity is required" validator="reorderQuantityValidator" />
                            </p:column>
                            <p:column>
                                <p:message for="reorderQuantity" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="unitPrice" value="Unit Price " />
                            </p:column>
                            <p:column>
                                <p:spinner id="unitPrice" value="#{productManagementManagedBean.selectedProductToUpdate.price}" placeholder="10.00" min="0" max="1000000" stepFactor="0.01" required="true" requiredMessage="Unit Price is required" />
                            </p:column>
                            <p:column>
                                <p:message for="unitPrice" />
                            </p:column>
                        </p:row>               

                        <p:row>
                            <p:column>
                                <p:outputLabel for="selCategory" value="Category " style="font-weight: bold;" />
                            </p:column>
                            <p:column>
                                <p:selectOneMenu id="selCategory" value="#{productManagementManagedBean.categoryIdUpdate}">
                                    <f:selectItem itemValue="0" itemLabel="[Select One]" noSelectionOption="true" />
                                    <f:selectItems value="#{productManagementManagedBean.allCategories}" var="categoryEntity" itemValue="#{categoryEntity.categoryId}" itemLabel="#{categoryEntity.name}" />
                                </p:selectOneMenu>
                            </p:column>
                            <p:column>
                                <p:message for="selCategory" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:outputLabel for="selTags" value="Tag(s) " style="font-weight: bold;" />
                            </p:column>
                            <p:column>
                                <p:selectManyMenu id="selTags" value="#{productManagementManagedBean.tagIdsUpdate}" showCheckbox="true">
                                    <f:selectItems value="#{productManagementManagedBean.allTags}" var="tagEntity" itemValue="#{tagEntity.tagId}" itemLabel="#{tagEntity.name}" />
                                </p:selectManyMenu>
                            </p:column>
                            <p:column>
                                <p:message for="selTags" />
                            </p:column>
                        </p:row>

                        <p:row style="text-align:center">
                            <p:column colspan="3">
                                <!-- INCOMPLETE -->
                                <p:commandButton value="Replace Current Image" icon="fa fa-image" />
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column colspan="3">
                                <p:commandButton value="Update Product" update="@form formAllProducts:dataGridAllProducts" actionListener="#{productManagementManagedBean.updateProduct}" oncomplete="PF('dialogUpdateProduct').show();" />
                            </p:column>
                        </p:row>

                    </p:panelGrid>

                </p:dialog>

            </h:form>

        </div>
    </ui:define>





</ui:composition>


